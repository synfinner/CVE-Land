#!/usr/bin/env python3
import json
import hashlib
import secrets
import os.path

# Get the filename for the tokens file
tokens_filename = 'tokens.json'

# Load the tokens from the JSON file
tokens = {}
if os.path.exists(tokens_filename):
    with open(tokens_filename, 'r') as f:
        tokens = json.load(f)

# Load the salt from the JSON file
with open('salt.json', 'r') as f:
    salt = json.load(f)['salt']

# Prompt the user to enter a username
username = input('Enter the username: ')

# Check if a token already exists for the given user
if username in tokens and 'hashed_token' in tokens[username]:
    hashed_token = tokens[username]['hashed_token']
else:
    # Generate a random token
    token = secrets.token_hex(16)

    # Hash the token using SHA-256 with the salt and the username
    hashed_token = hashlib.sha256((salt + username + token).encode('utf-8')).hexdigest()

    # Add the hashed token to the dictionary for the given username
    if username not in tokens:
        tokens[username] = {}
    tokens[username]['hashed_token'] = hashed_token

    # Save the dictionary to the tokens file
    with open(tokens_filename, 'w') as f:
        json.dump(tokens, f)

    print(f'Token has been hashed and saved to {tokens_filename} for user {username}')
    print(f'The plain token is: {token}')
